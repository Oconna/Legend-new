<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategiespiel - Lobby</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header class="game-header">
            <h1>üè∞ Online Strategiespiel</h1>
            <p>Erobere St√§dte, f√ºhre Armeen, herrsche √ºber das Land!</p>
        </header>

        <main class="lobby-main">
            <!-- Player Info Section -->
            <section class="player-section">
                <div class="player-info">
                    <label for="playerNameInput">Dein Name:</label>
                    <input type="text" id="playerNameInput" placeholder="Spielername eingeben..." maxlength="20">
                </div>
            </section>

            <!-- Game List Section -->
            <section id="gameListSection" class="lobby-sections">
                <!-- Game Creation Section -->
                <section class="create-game-section">
                    <h2>Neues Spiel erstellen</h2>
                    <div class="game-form">
                        <div class="form-group">
                            <label for="gameName">Spielname:</label>
                            <input type="text" id="gameName" placeholder="Mein Strategiespiel" maxlength="50">
                        </div>
                        
                        <div class="form-group">
                            <label for="maxPlayers">Spieler (2-8):</label>
                            <select id="maxPlayers">
                                <option value="2">2 Spieler</option>
                                <option value="3">3 Spieler</option>
                                <option value="4" selected>4 Spieler</option>
                                <option value="5">5 Spieler</option>
                                <option value="6">6 Spieler</option>
                                <option value="7">7 Spieler</option>
                                <option value="8">8 Spieler</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="mapSize">Kartengr√∂√üe:</label>
                            <select id="mapSize">
                                <option value="20">Klein (20x20)</option>
                                <option value="30" selected>Mittel (30x30)</option>
                                <option value="50">Gro√ü (50x50)</option>
                                <option value="100">Riesig (100x100)</option>
                            </select>
                        </div>
                        
                        <button id="createGameBtn" class="btn btn-primary">Spiel erstellen</button>
                    </div>
                </section>

                <!-- Available Games Section -->
                <section class="games-section">
                    <h2>Verf√ºgbare Spiele</h2>
                    <div class="games-container">
                        <div id="gamesList" class="games-list">
                            <div class="loading">Lade Spiele...</div>
                        </div>
                    </div>
                    <div class="games-actions">
                        <button id="refreshGamesBtn" class="btn btn-secondary">Spiele aktualisieren</button>
                    </div>
                </section>
            </section>

            <!-- Current Game Lobby Section (shown when in a game) -->
            <section id="gameLobbySection" class="current-game-section" style="display: none;">
                <h2>Aktuelle Spiellobby</h2>
                <div class="current-game-container">
                    <!-- Left side: Game Lobby Info -->
                    <div class="game-lobby-left">
                        <div class="current-game-info">
                            <div class="game-header">
                                <h3 id="currentGameName">Spielname</h3>
                                <div class="game-meta">
                                    <span>Spieler: <span id="currentGamePlayerCount">0</span>/<span id="currentGameMaxPlayers">0</span></span>
                                    <span>Karte: <span id="currentGameMapSize">0</span>x<span id="currentGameMapSizeY">0</span></span>
                                </div>
                            </div>
                            
                            <div class="players-lobby">
                                <h4>Spieler in der Lobby:</h4>
                                <div id="gameLobbyPlayersList" class="players-lobby-list">
                                    <!-- Players will be populated here -->
                                </div>
                            </div>
                            
                            <div class="lobby-controls">
                                <button id="readyBtn" class="btn btn-success">Bereit</button>
                                <button id="startGameBtn" class="btn btn-primary" style="display: none;">Spiel starten</button>
                                <button id="leaveLobbyBtn" class="btn btn-danger">Lobby verlassen</button>
                            </div>
                            
                            <div class="lobby-status">
                                <p id="lobbyStatusText">Warte auf andere Spieler...</p>
                                <p id="readyStatusText">Bereit: <span id="readyCount">0</span>/<span id="totalPlayers">0</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Right side: Lobby Chat -->
                    <div class="game-lobby-right">
                        <div id="lobbyChat" class="lobby-chat">
                            <div class="chat-header">
                                <h4>üí¨ Lobby Chat</h4>
                                <span class="chat-info">
                                    <span id="lobbyChatPlayerCount">0</span> Spieler online
                                </span>
                            </div>
                            <div class="chat-messages-container">
                                <div id="lobbyChatMessages" class="chat-messages">
                                    <!-- Chat messages will be displayed here -->
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <div class="chat-input-wrapper">
                                    <textarea 
                                        id="lobbyChatMessageInput" 
                                        class="chat-input" 
                                        placeholder="Schreibe eine Nachricht..."
                                        maxlength="500"
                                        rows="1"></textarea>
                                    <button id="lobbyChatSendButton" class="chat-send-btn" title="Nachricht senden">
                                        üì§
                                    </button>
                                </div>
                                <div class="chat-controls">
                                    <small class="char-count">
                                        <span id="lobbyChatCharCount">0</span>/500
                                    </small>
                                    <small class="chat-hint">
                                        Enter zum Senden
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Race Selection Modal with Chat -->
        <div id="raceSelectionModal" class="modal">
            <div class="modal-content race-selection-modal">
                <div class="modal-header">
                    <h3>Rassenwahl</h3>
                    <p>W√§hle deine Rasse f√ºr das Spiel. Jede Rasse hat einzigartige Einheiten!</p>
                </div>
                <div class="modal-body">
                    <div class="race-selection-with-chat">
                        <!-- Left side: Race Selection -->
                        <div class="race-selection-panel">
                            <div class="race-selection">
                                <div id="racesList" class="races-grid">
                                    <!-- Races will be loaded here -->
                                </div>
                                <div class="race-info">
                                    <div id="selectedRaceInfo" class="selected-race-info">
                                        <p>W√§hle eine Rasse aus der Liste oben.</p>
                                    </div>
                                </div>
                                <div class="race-selection-actions">
                                    <button id="confirmRaceBtn" class="btn btn-success" disabled>
                                        Rasse best√§tigen
                                    </button>
                                    <button id="changeRaceBtn" class="btn btn-secondary" style="display: none;">
                                        Rasse √§ndern
                                    </button>
                                </div>
                                <div class="race-selection-status">
                                    <p id="raceSelectionStatus">W√§hle deine Rasse aus...</p>
                                </div>
                                <div class="race-players-status">
                                    <h4>Spieler Status:</h4>
                                    <div id="racePlayersStatus" class="players-race-status">
                                        <!-- Player race status will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right side: Chat -->
                        <div class="chat-panel">
                            <div id="raceSelectionChat" class="race-chat">
                                <div class="chat-header">
                                    <h4>üí¨ Chat</h4>
                                    <span class="chat-info">
                                        <span id="chatPlayerCount">0</span> Spieler online
                                    </span>
                                </div>
                                <div class="chat-messages-container">
                                    <div id="chatMessages" class="chat-messages">
                                        <!-- Chat messages will be displayed here -->
                                    </div>
                                </div>
                                <div class="chat-input-container">
                                    <div class="chat-input-wrapper">
                                        <textarea 
                                            id="chatMessageInput" 
                                            class="chat-input" 
                                            placeholder="Schreibe eine Nachricht..."
                                            maxlength="500"
                                            rows="1"></textarea>
                                        <button id="chatSendButton" class="chat-send-btn" title="Nachricht senden">
                                            üì§
                                        </button>
                                    </div>
                                    <div class="chat-controls">
                                        <small class="char-count">
                                            <span id="chatCharCount">0</span>/500
                                        </small>
                                        <small class="chat-hint">
                                            Enter zum Senden
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Game Modal -->
        <div id="createGameModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Neues Spiel erstellen</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="createGameForm">
                        <div class="form-group">
                            <label for="gameNameInput">Spielname:</label>
                            <input type="text" id="gameNameInput" required maxlength="50" placeholder="Mein Strategiespiel">
                        </div>
                        <div class="form-group">
                            <label for="maxPlayersInput">Maximale Spieler:</label>
                            <select id="maxPlayersInput" required>
                                <option value="2">2 Spieler</option>
                                <option value="3">3 Spieler</option>
                                <option value="4" selected>4 Spieler</option>
                                <option value="5">5 Spieler</option>
                                <option value="6">6 Spieler</option>
                                <option value="7">7 Spieler</option>
                                <option value="8">8 Spieler</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mapSizeInput">Kartengr√∂√üe:</label>
                            <select id="mapSizeInput" required>
                                <option value="20">Klein (20x20)</option>
                                <option value="30" selected>Mittel (30x30)</option>
                                <option value="50">Gro√ü (50x50)</option>
                                <option value="100">Riesig (100x100)</option>
                            </select>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" id="confirmCreateGameBtn" class="btn btn-primary">Spiel erstellen</button>
                            <button type="button" class="btn btn-secondary cancel-btn">Abbrechen</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Join Game Modal -->
        <div id="joinGameModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Spiel beitreten</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="joinGameInfo">
                        <p>M√∂chtest du diesem Spiel beitreten?</p>
                        <div id="joinGameDetails">
                            <!-- Game details will be shown here -->
                        </div>
                        <div class="modal-actions">
                            <button id="confirmJoinGameBtn" class="btn btn-primary">Beitreten</button>
                            <button class="btn btn-secondary cancel-btn">Abbrechen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div id="loadingModal" class="modal">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="loading-content">
                        <div class="spinner"></div>
                        <h3 id="loadingTitle">Lade...</h3>
                        <p id="loadingMessage">Bitte warten...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Modal -->
        <div id="errorModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ùå Fehler</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="errorMessage">
                        <p>Ein Fehler ist aufgetreten.</p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div id="notifications" class="notifications"></div>

        <!-- Connection Status -->
        <div id="connectionStatus" class="connection-status">
            <span id="connectionStatusText">Verbinde...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/lobby.js"></script>
</body>
</html>